services:
  claude-box:
    image: ghcr.io/andresmorales07/claude-box:latest
    container_name: claude-box
    hostname: claude-box
    runtime: sysbox-runc
    cap_add:
      - NET_ADMIN
    devices:
      - "/dev/net/tun:/dev/net/tun"
    ports:
      - "2222:2222"
      - "7681:7681"
      - "8080:8080"
      - "60000-60003:60000-60003/udp"
    volumes:
      - claude-home:/home/claude
      - docker-data:/var/lib/docker
    environment:
      - CLAUDE_USER_PASSWORD=${CLAUDE_USER_PASSWORD:-changeme}
      - TTYD_USERNAME=${TTYD_USERNAME:-claude}
      - TTYD_PASSWORD=${TTYD_PASSWORD:-changeme}
      - TS_AUTHKEY=${TS_AUTHKEY:-}
      - TS_HOSTNAME=${TS_HOSTNAME:-claude-box}
      - DOTFILES_REPO=${DOTFILES_REPO:-}
      - API_PASSWORD=${API_PASSWORD:-changeme}
      - DOTFILES_BRANCH=${DOTFILES_BRANCH:-}
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f -u \"${TTYD_USERNAME}:${TTYD_PASSWORD}\" http://localhost:7681 && curl -f http://localhost:8080/healthz && docker info > /dev/null 2>&1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

volumes:
  claude-home:
  docker-data:
